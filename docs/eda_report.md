# 数据概览与问题分析

## 1. 数据集基本信息
- **训练集**：`data/raw/train.csv`，共 8,990 行、98 列，`date_id` 范围 0–8989。
- **测试集**：`data/raw/test.csv`，10 行、99 列（包含 `is_scored` 等 lagged 字段），`date_id` 8980–8989，与训练集尾部重叠。
- 每个 `date_id` 在训练集中仅出现一次，代表逐日预测任务；测试集覆盖最近 10 天，说明评测聚焦在最新时间窗口。

## 2. 关键字段
- `forward_returns`：主要预测目标（未来收益），均值 ≈ 4.69e-4，标准差 ≈ 0.0106，轻微负偏，峰度 < 3。
- `risk_free_rate` 与 `market_forward_excess_returns`：辅助收益指标，均值约 1e-4，波动尺度与目标类似。
- 特征前缀：
  - `D1`-`D9`：二元/三元离散变量（0/1 或 0/-1），多数以 0 为主。
  - `E*`、`I*`、`M*`、`P*`、`S*`、`V*`：连续因子，取值范围 [-5, 36]，存在极端值。
  - `test.csv` 额外提供 `lagged_*` 字段，可作为滞后特征参考。

## 3. 缺失值概况
- 训练集整体缺失率约 15.6%；`E7`、`V10`、`S3`、`M1`、`M13`、`M14`、`M6`、`V9` 等列缺失 > 50%。
- 约 70 列缺失率固定在 ≈ 11%，而测试集同列缺失率为 0，缺失集中在早期日期。
- 二元特征 (`D` 系列) 无缺失。

**潜在影响**：
- 训练集缺失分布极度不均匀（早期缺失多、后期完整），若不分日期处理会导致模型对最近时期的数据产生偏差。
- 部分列缺失率过高且与目标相关性低，可能引入噪声。

**建议应对方案**：
1. 按 `date_id` 进行分层填充：可使用滚动窗口均值/前向填充，保证后期数据尽量不依赖未来信息。
2. 为缺失列添加缺失指示器（`<col>_is_na`），保留缺失模式信息。
3. 若缺失严重且特征贡献低，可考虑剔除（例如高于 70% 的列，将在特征重要性阶段评估）。

## 4. 数值分布与异常
- 若干列存在绝对值 > 10 的离群点（如 `E8` max ≈ 35.9，`V13` max ≈ 24.1，`S5` min ≈ -13.12）。
- 二元特征高度不平衡，`D1/D2` 中 1 的比例仅约 3%。

**建议应对方案**：
- 对极端值进行 winsorize（按 1%/99% 分位裁剪）或标准化，避免线性模型受影响。
- 对二元特征保留原序列，同时构造滚动出现次数、连涨/连跌长度等派生特征。

## 5. 目标统计
- `forward_returns` 波动小但含噪，需要关注 tail 分布。可尝试：
  - 使用 MAE、Huber 损失或对目标 Winsorize。
  - 引入 `market_forward_excess_returns`、`risk_free_rate` 作为多任务/辅助标签，增强稳定性。

## 6. 训练与评估策略
- 时间序列约束：使用滚动或扩张窗口 cross-validation（例如 80% 训练、20% 验证，窗口前移）以模拟真实预测。
- 基线模型建议从 LightGBM/XGBoost 入手，天然支持缺失值；逐步加入 CatBoost、线性模型等对比。
- 需要在 `experiments/` 记录每次训练配置、特征集、验证得分。

## 7. 特征工程思路
1. **滞后与滚动统计**：对连续特征计算过去 5/10/20 日均值、标准差、z-score，构造特征趋势。
2. **离散特征强化**：对 `D` 系列生成累计出现次数、最近一次出现距今天数等因子。
3. **截面组合**：交互项或聚合（`E*` 与 `M*` 差值、比率）以刻画组合效应。
4. **宏观调节**：利用 `risk_free_rate`、`market_forward_excess_returns` 构造市值/风险指标，如目标差异、人为 regime 标签。

## 8. 风险与监控
- **时间泄露**：任何插补或特征必须只依赖历史数据，严禁跨未来日期。
- **概念漂移**：测试期集中在末尾 10 天，需要持续比较验证期与训练期分布（PSI/KL divergence）；必要时对比更近时间窗口训练模型。
- **过拟合**：特征数量大+缺失多，需通过正则化、早停、dropout（神经网络）等控制；同时保留简单基线作为 sanity check。

## 9. 下一步动作
- 在 `00_project_todo.ipynb` 继续补充 EDA 图表（目标分布、滚动均值、相关热力图）。
- 设计缺失值处理函数并编写单元测试验证不引入未来信息。
- 制定特征配置（`configs/features.yml`），明确要保留/剔除的列与窗口参数。
- 建立 LightGBM 基线并记录第一轮实验结果，作为后续迭代起点。
